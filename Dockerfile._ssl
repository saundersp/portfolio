FROM node:22.9.0-alpine3.20 AS builder

WORKDIR /home/saundersp/portfolio

COPY public public
COPY src src
COPY package.json package-lock.json ./

RUN npm i && npm run build && rm -rv node_modules

FROM node:22.9.0-alpine3.20

WORKDIR /home/saundersp/portfolio

RUN npm i -g http-server

COPY --from=builder /home/saundersp/portfolio/build build
COPY certificates /home/saundersp/portfolio/certificates

EXPOSE 443

CMD ["http-server", "build", "-p", "443", \
	"-S", "-C", "certificates/cert.pem", \
	"-K", "certificates/privkey.pem"]
